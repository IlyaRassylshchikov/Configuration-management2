# Инструмент визуализации графа зависимостей

Инструмент для визуализации графа зависимостей npm пакетов.

## Этапы реализации

###  Этап 1: Минимальный прототип с конфигурацией
###  Этап 2: Сбор данных о зависимостях

## Возможности

- Настройка имени анализируемого npm пакета
- Указание URL npm registry или пути к тестовому репозиторию
- Режим работы с тестовым репозиторием
- Фильтрация пакетов по подстроке
- Извлечение прямых зависимостей из npm registry
- Вывод дерева зависимостей
- Валидация всех параметров с обработкой ошибок

## Установка

```bash
# Клонирование репозитория
git clone https://github.com/IlyaRassylshchikov/Configuration-management2.git
cd Configuration-management2

# Дать права на выполнение (для Linux/Mac)
chmod +x dependency_visualizer.py
```

## Использование

### Основной синтаксис

```bash
python dependency_visualizer.py -p <имя_пакета> -r <url_или_путь> [опции]
```

### Примеры

#### 1. Анализ реального npm пакета

```bash
# Express.js
python dependency_visualizer.py -p express -r https://registry.npmjs.org

# React
python dependency_visualizer.py -p react -r https://registry.npmjs.org

# Lodash
python dependency_visualizer.py -p lodash -r https://registry.npmjs.org
```

#### 2. Работа с тестовым репозиторием

```bash
# Создать тестовые данные
python test_examples.py

# Использовать тестовый репозиторий
python dependency_visualizer.py -p express -r test_data/npm_packages.json -t
```

#### 3. Фильтрация зависимостей

```bash
# Показать только зависимости, содержащие "babel"
python dependency_visualizer.py -p react -r https://registry.npmjs.org -f "babel"

# Показать только зависимости, содержащие "types"
python dependency_visualizer.py -p typescript -r https://registry.npmjs.org -f "types"
```

#### 4. Полный пример со всеми параметрами

```bash
python dependency_visualizer.py -p express -r https://registry.npmjs.org -f "body" -d 1
```

## Параметры командной строки

| Параметр | Краткая форма | Описание | Обязательный | По умолчанию |
|----------|---------------|----------|--------------|--------------|
| `--package` | `-p` | Имя анализируемого npm пакета | Да | - |
| `--repo` | `-r` | URL npm registry или путь к файлу | Да | - |
| `--test-mode` | `-t` | Режим тестового репозитория | Нет | `False` |
| `--filter` | `-f` | Подстрока для фильтрации | Нет | - |
| `--max-depth` | `-d` | Максимальная глубина анализа | Нет | `1` |
| `--help` | `-h` | Показать справку | Нет | - |
| `--version` | `-v` | Показать версию | Нет | - |

## Формат данных

### npm Registry API

Приложение работает с официальным npm registry API:
- URL: `https://registry.npmjs.org`
- Формат: JSON
- Метод: GET запрос к `https://registry.npmjs.org/<package_name>`

### Формат тестовых данных

Поддерживаются два формата:

#### Формат 1: Словарь пакетов
```json
{
  "express": {
    "name": "express",
    "version": "4.18.2",
    "dependencies": {
      "body-parser": "^1.20.1",
      "cookie": "^0.5.0",
      "debug": "^2.6.9"
    }
  }
}
```

#### Формат 2: Список пакетов
```json
{
  "packages": [
    {
      "name": "express",
      "version": "4.18.2",
      "dependencies": ["body-parser", "cookie", "debug"]
    }
  ]
}
```

## Примеры вывода

### Успешный анализ

```
============================================================
КОНФИГУРАЦИЯ ИНСТРУМЕНТА ВИЗУАЛИЗАЦИИ ЗАВИСИМОСТЕЙ
============================================================
Имя пакета:              express
URL/Путь репозитория:    https://registry.npmjs.org
Тестовый режим:          Выключен
Фильтр пакетов:          Не установлен
Максимальная глубина:    1
============================================================

============================================================
АНАЛИЗ ЗАВИСИМОСТЕЙ ПАКЕТА: express
============================================================

✓ Найдено прямых зависимостей: 31

express
├─ accepts @ ~1.3.8
├─ array-flatten @ 1.1.1
├─ body-parser @ 1.20.1
├─ content-disposition @ 0.5.4
├─ cookie @ 0.5.0
├─ debug @ 2.6.9
└─ ... (еще 25 зависимостей)

============================================================

✓ Анализ успешно завершён!
```

### С фильтрацией

```
============================================================
АНАЛИЗ ЗАВИСИМОСТЕЙ ПАКЕТА: react
============================================================

✓ Найдено прямых зависимостей: 2

react
├─ @babel/runtime @ ^7.12.5
└─ loose-envify @ ^1.1.0

============================================================
```

## Обработка ошибок

Приложение обрабатывает следующие ошибки:

1. **Конфигурационные ошибки**:
   - Пустое имя пакета
   - Некорректный URL
   - Несуществующий файл в тестовом режиме

2. **Ошибки получения данных**:
   - Пакет не найден (404)
   - Ошибки соединения
   - Ошибки парсинга JSON
   - Таймаут подключения

3. **Системные ошибки**:
   - Прерывание пользователем (Ctrl+C)
   - Неожиданные исключения

## Требования

- Python 3.6 или выше
- Стандартная библиотека Python (без дополнительных зависимостей)
- Доступ к интернету (для работы с npm registry)

## Тестирование

### Автоматические тесты

```bash
# Запуск всех тестов
python test_examples.py

# Или через скрипты
# Windows:
run_tests.bat

# Linux/Mac:
./run_tests.sh

# PowerShell:
.\run_tests.ps1
```

### Ручное тестирование

```bash
# 1. Создать тестовые данные
mkdir -p test_data
cat > test_data/npm_packages.json << 'EOF'
{
  "express": {
    "name": "express",
    "version": "4.18.2",
    "dependencies": {
      "body-parser": "^1.20.1",
      "cookie": "^0.5.0",
      "debug": "^2.6.9"
    }
  },
  "react": {
    "name": "react",
    "version": "18.2.0",
    "dependencies": {
      "loose-envify": "^1.1.0"
    }
  }
}
EOF

# 2. Протестировать с тестовыми данными
python dependency_visualizer.py -p express -r test_data/npm_packages.json -t
```

## Структура проекта

```
.
├── dependency_visualizer.py  # Основной файл приложения
├── README.md                 # Документация
├── test_examples.py          # Тестовые примеры
├── requirements.txt          # Зависимости проекта
├── run_tests.sh             # Скрипт запуска тестов (Linux/Mac)
├── run_tests.bat            # Скрипт запуска тестов (Windows CMD)
├── run_tests.ps1            # Скрипт запуска тестов (Windows PowerShell)
└── test_data/               # Директория для тестовых данных
    └── npm_packages.json    # Тестовый репозиторий npm пакетов
```

## Известные ограничения

- Для Этапа 2 анализируются только прямые зависимости (глубина = 1)
- Не используются сторонние библиотеки для работы с npm
- Таймаут запросов: 10 секунд
- Кеширование запросов в рамках одного сеанса

## История версий

### v0.2.0 (Этап 2) - 2025-11-22
-  Добавлена поддержка npm пакетов
-  Реализовано извлечение прямых зависимостей из npm registry
-  Добавлен вывод дерева зависимостей
-  Реализована работа с тестовыми данными в формате JSON
-  Добавлена обработка ошибок сети и парсинга

### v0.1.0 (Этап 1) - 2025-11-22
-  Реализовано CLI-приложение с argparse
-  Добавлены настраиваемые параметры
-  Реализована валидация параметров
-  Добавлена документация

